<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
   "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY xorg-server-download-http "http://xorg.freedesktop.org/releases/individual/xserver/xorg-server-&xorg-server-version;.tar.bz2">
  <!ENTITY xorg-server-download-ftp  "ftp://ftp.x.org/pub/individual/xserver/xorg-server-&xorg-server-version;.tar.bz2">
  <!ENTITY xorg-server-md5sum        "d070c58a598fb52c5cb86344725c4ad6">
  <!ENTITY xorg-server-size          "6.1 MB">
  <!ENTITY xorg-server-buildsize     "424 MB">
  <!ENTITY xorg-server-time          "5.6 SBU">

]>

<sect1 id="xorg7-server" xreflabel="Xorg-Server-&xorg-server-version;">
  <?dbhtml filename="x7server.html"?>

  <sect1info>
    <othername>$LastChangedBy$</othername>
    <date>$Date$</date>
  </sect1info>

  <title>Xorg-Server-&xorg-server-version;</title>

  <indexterm zone="xorg7-server">
    <primary sortas="a-xorg7-server">Xorg Server</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction to Xorg-Server</title>

    <para>The <application>Xorg</application> Server is the core
    of the X Window system.</para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Download (HTTP): <ulink url="&xorg-server-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Download (FTP): <ulink url="&xorg-server-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Download MD5 sum: &xorg-server-md5sum;</para>
      </listitem>
      <listitem>
        <para>Download size: &xorg-server-size;</para>
      </listitem>
      <listitem>
        <para>Estimated disk space required: &xorg-server-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimated build time: &xorg-server-time;</para>
      </listitem>
    </itemizedlist>

    <!-- Following patch is security related and should be
        fixed for Xorg-7.2 -->
    <bridgehead renderas="sect3">Additional Downloads</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Required patch: <ulink
        url="&patch-root;/xorg-server-1.1.0-security-1.patch"/></para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Xorg Server Dependencies</bridgehead>

    <bridgehead renderas="sect4">Required</bridgehead>
    <para role="required"><xref linkend="xorg7-font"/></para>

    <bridgehead renderas="sect4">Optional</bridgehead>
    <para role="optional"><xref linkend="mesalib"/> and
    <xref linkend="luit"/></para>

    <para condition="html" role="usernotes">User Notes:
    <ulink url='&blfs-wiki;/Xorg7Server'/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation of Xorg Server</title>

    <note>
      <para>If you intend to build with <application>Mesa</application>,
      you must have the <application>Mesa</application> source
      directory available when building the
      <application>Xorg-server</application>.</para>
    </note>

<!-- To be removed if/when proposed glibc patch is added to LFS SVN
     Leave in in for a couple of weeks with 'you may need' and a testcase
     around it to save the support list silly questions.  Should remove in
     a couple of weeks
      <para>Recent <application>Glibc</application> may have a problem with its
      installed <filename>sys/kd.h</filename> file. This has recently been
      fixed in LFS SVN.  Execute the following commands to work around a
      broken <filename>kd.h</filename> file.  The commands will only make the
      modification if needed:</para>

<screen><userinput>grep "__undef_LINUX" \
    /usr/include/sys/kd.h 2&gt;&amp;1 &gt; /dev/null || \
    sed -i.bak '/CONFIG_H/i #include &lt;linux/types.h&gt;' \
        hw/xfree86/os-support/linux/lnx_agp.c</userinput></screen>
 End remove -->

    <para>Multiple <ulink url='http://wiki.x.org/wiki/SecurityPage'>security
    vulnerabilities</ulink> have been identified in the xorg-server
    package. Apply a patch to fix these vulnerabilities with the following
    command:</para>

<screen><userinput>patch -Np1 -i ../xorg-server-1.1.0-security-1.patch</userinput></screen>

    <para>Install the server by running the following commands:</para>

<screen><userinput>sed -i \
    's@-I$(top_builddir)/include@-I$(top_builddir)/GL/mesa/main@8' \
    GL/glx/Makefile.in &amp;&amp;
sed -i \
    's@-I$(top_builddir)/include@-I$(top_builddir)/GL/mesa/glapi@7' \
    GL/glx/Makefile.in &amp;&amp;
./configure $XORG_CONFIG \
    --with-mesa-source='<replaceable>&lt;/path/to&gt;</replaceable>/Mesa-&mesalib-version;' \
    --with-fontdir=$XORG_PREFIX/lib/X11/fonts \
    --with-module-dir=$XORG_PREFIX/lib/X11/modules \
    --with-dri-driver-path=$XORG_PREFIX/lib/X11/modules/dri \
    --enable-install-setuid &amp;&amp;
make</userinput></screen>

    <para>This package does not come with a test suite.</para>

    <para>Now as the <systemitem class="username">root</systemitem>
    user:</para>

<screen role="root"><userinput>make install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Command Explanations</title>

    <para><command>sed -i '...' GL/glx/Makefile.in</command>: These commands
    correct the search path for the <application>Mesa</application> headers.
    The 8th and 7th instance of '-I$(top_builddir)' in the existing search
    search path are replaced with <application>Mesa</application> paths.</para>

    <para><parameter>--with-mesa-source=...</parameter>: This switch directs
    the build system to the location of the <application>Mesa</application>
    source directory.  If you wish to build without
    <application>Mesa</application>, omit this switch.</para>

    <para><parameter>--with-module-dir=...</parameter>:  This parameter
    sets the destination for the installed modules.</para>

    <para><parameter>--with-dri-driver-path=...</parameter>:  This is the
    location of the <application>Mesa</application> DRI drivers.</para>

    <para><parameter>--enable-install-setuid</parameter>: The Xorg binary must
    run as the root user.  This switch ensures that the binary is installed
    setuid when <command>make</command> is run by an unprivileged user.</para>

    <para><parameter>--disable-glx</parameter>: Disable building of the GLX
    extension.  This parameter is required if building without
    <application>Mesa</application>.</para>

    <para><parameter>--disable-dri</parameter>: Disable building of the DRI
    extension.  This parameter is required if building without
    <application>Mesa</application>.</para>

    <para><parameter>--disable-xprint</parameter>: Disable building of
    the <application>Xprint</application>  extension and server.  This
    parameter is required if building without
    <application>Mesa</application>.</para>

  </sect2>

</sect1>
