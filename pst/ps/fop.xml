<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY fop-download-http "http://archive.apache.org/dist/xmlgraphics/fop/source/fop-&fop-version;-src.tar.gz">
  <!-- <!ENTITY fop-download-ftp  "ftp://apache.mirrors.pair.com/xmlgraphics/fop/fop-&fop-version;-src.tar.gz"> -->
  <!ENTITY fop-download-ftp  "&sources-anduin-ftp;/f/fop-&fop-version;-src.tar.gz">
  <!ENTITY fop-md5sum        "58593e6c86be17d7dc03c829630fd152">
  <!ENTITY fop-size          "13.1 MB">
  <!ENTITY fop-buildsize     "356 MB">
  <!ENTITY fop-time          "1.4 SBU">

  <!ENTITY jai-version       "1_1_3">
  <!ENTITY jai-download      "http://download.java.net/media/jai/builds/release/&jai-version;/jai-&jai-version;-lib-linux-i586-jdk.bin">
  <!ENTITY jai-md5sum        "a63b661c4940582aa1679233e5f518b2">
  <!ENTITY jai-size          "3.4 MB">

  <!ENTITY offo-download     "&sourceforge-repo;/offo/offo-hyphenation_v1.2.zip">
  <!ENTITY offo-md5sum       "b2e64872ab0b5e6ada1d37778f8a1935">
  <!ENTITY offo-size         "378 KB">
]>

<sect1 id="fop" xreflabel="FOP-&fop-version;">
  <?dbhtml filename="fop.html"?>

  <sect1info>
    <othername>$LastChangedBy$</othername>
    <date>$Date$</date>
  </sect1info>

  <title>FOP-&fop-version;</title>

  <indexterm zone="fop">
    <primary sortas="a-FOP">FOP</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction to FOP</title>

    <para>The <application>FOP</application> (Formatting Objects Processor)
    package contains a print formatter driven by XSL formatting objects
    (XSL-FO). It is a <application>Java</application> application that reads
    a formatting object tree and renders the resulting pages to a specified
    output. Output formats currently supported include PDF, PCL, PostScript,
    SVG, XML (area tree representation), print, AWT, MIF and ASCII text. The
    primary output target is PDF.</para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Download (HTTP): <ulink url="&fop-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Download (FTP): <ulink url="&fop-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Download MD5 sum: &fop-md5sum;</para>
      </listitem>
      <listitem>
        <para>Download size: &fop-size;</para>
      </listitem>
      <listitem>
        <para>Estimated disk space required: &fop-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimated build time: &fop-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Additional Downloads</bridgehead>

    <itemizedlist spacing="compact">
      <title>Required packages</title>
      <listitem>
        <para>Objects for Formatting Objects (OFFO) hyphenation patterns:
          <simplelist>
            <member><ulink url="&offo-download;"/></member>
            <member>&offo-md5sum;</member>
            <member>&offo-size;</member>
          </simplelist>
        </para>
      </listitem>
      <listitem>
        <para>Java Advanced Imaging (JAI) API components:
          <simplelist>
            <member><ulink url="&jai-download;"/></member>
            <member>&jai-md5sum;</member>
            <member>&jai-size;</member>
          </simplelist>
        </para>
      </listitem>
    </itemizedlist>

    <!-- <itemizedlist spacing='compact'>
      <title>Required patch</title>
      <listitem>
        <para><ulink
        url="&patch-root;/fop-&fop-version;-jdk_1.5.0-1.patch"/></para>
      </listitem>
    </itemizedlist> -->

    <bridgehead renderas="sect3">FOP Dependencies</bridgehead>

    <bridgehead renderas="sect4">Required</bridgehead>
    <para role="required"><xref linkend="xorg7"/>,
    <xref linkend="apache-ant"/>, and
    <ulink url="http://java.sun.com/javase/technologies/desktop/media/jai/">Java
    Advanced Imaging (JAI) API components</ulink></para>

    <bridgehead renderas="sect4">Optional</bridgehead>
    <para role="optional"><ulink url="http://java.sun.com/products/jimi/">JIMI SDK</ulink>,
    <ulink url="http://xmlunit.sourceforge.net/">XMLUnit</ulink>, and
    <ulink url="http://forrest.apache.org/">Forrest</ulink> (only used to rebuild
    the documentation)</para>

    <para condition="html" role="usernotes">User Notes:
    <ulink url="&blfs-wiki;/fop"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation of FOP</title>

    <para>You must run this installation from an X-window using a GL-aware
    Xorg server or some of the JUnit tests will hang. Using an X-window from
    the console is the preferred method.</para>

    <para>Ensure <envar>$JAVA_HOME</envar> is set correctly before beginning
    the build. To build the <application>JIMI SDK</application> and/or
    <application>XMLUnit</application> extension classes, ensure the
    corresponding <filename class='extension'>.jar</filename> files are
    identified in the <envar>CLASSPATH</envar> environment variable.</para>

    <!-- <para>Some versions of tar will display a message similar to
    <quote><computeroutput>tar: A lone zero block at 33476</computeroutput></quote>
    when unpacking the source tarball. You may safely ignore this message.</para> -->

    <sect3>
      <title>Installing OFFO Hyphenation Patterns</title>

      <para>Before beginning the build, unpack the
      <application>FOP</application> source tarball and the hyphenation zipfile
      from the same directory, then change directories into the root of the
      <application>FOP</application> source tree. The XML Hyphenation patterns
      will be copied into the <application>FOP</application> source tree by
      running the following commands:</para>

<screen><userinput>cp ../offo-hyphenation/hyph/* hyph &amp;&amp;
rm -rf ../offo-hyphenation</userinput></screen>

    </sect3>

    <sect3>
      <title>Installing JAI</title>

      <tip>
        <para>The <command>$FOP_PKG_DIR/jai-&jai-version;-lib-linux-i586-jdk.bin</command>
        command below installs the JAI components in the JDK tree. You will be
        required to view, and then accept (by entering a <keycap>y</keycap>
        keypress), a license agreement before the installation will continue.
        If you are scripting (automating) the build, you'll need to account for
        this. There is information about automating build commands in the
        <xref linkend="automating-builds"/> section of Chapter 2. Towards the
        end of this section, specific information for automating this type of
        installation is discussed.</para>
      </tip>

      <para>Install the JAI components by running the following commands as
      the <systemitem class="username">root</systemitem> user while in the
      root of the <application>FOP</application> source tree:</para>

<!-- JAI make tail +nnn only for SunOS now
<screen role="root"><userinput>install -m755 ../jai-&jai-version;-lib-linux-i586-jdk.bin JAI.bin &amp;&amp;
sed -i 's/tail +122/tail -n +122/' JAI.bin &amp;&amp;
-->
<screen role="root"><userinput>FOP_PKG_DIR=$(pwd)/.. &amp;&amp;
pushd $JAVA_HOME &amp;&amp;
sh $FOP_PKG_DIR/jai-&jai-version;-lib-linux-i586-jdk.bin &amp;&amp;
popd</userinput></screen>

    </sect3>

    <sect3>
      <title>Installing FOP Components</title>

      <para>If <application>forrest</application> is not installed, remove
      a reference to it in the build.xml:</para>
<screen><userinput>sed -i -e "s/all,javadocs,docs/all,javadocs/" \
           -e '\#${dist.bin.result.dir}/docs#,\#&lt;/copy&gt;#d' build.xml</userinput></screen>

      <para>Compile <application>FOP</application> by running the
      following commands:</para>

<screen><userinput>ant dist</userinput></screen>

      <para>The unit regression tests were performed in the build step
      above.</para>

      <para>Now install FOP as the <systemitem class="username">root</systemitem> user:</para>

<screen role="root"><userinput>install -v -d -m755 /opt/fop-&fop-version; &amp;&amp;
pushd dist-bin/fop-&fop-version; &amp;&amp;
cp -v -R * /opt/fop-&fop-version; &amp;&amp;
popd &amp;&amp;
ln -v -sf fop-&fop-version; /opt/fop</userinput></screen>

    </sect3>

    <!-- <sect3>
      <title>Installing the Batik JAR</title>

      <para>You'll need to install one additional <application>Java</application>
      class library to process SVG objects. This library is part of the
      <ulink url="http://xml.apache.org/batik/">Batik</ulink> package, but is
      also included with the <application>FOP</application> package. If you
      have <application>Batik</application> installed, ensure the
      <filename>batik.jar</filename> library is included in your
      <envar>$CLASSPATH</envar> environment variable. Alternatively, create a
      symbolic link from <filename>/opt/fop-&fop-version;/lib/batik.jar</filename>
      pointing to the full path of the installed <filename>batik.jar</filename>
      file so that the <command>fop.sh</command> script will automatically pick it
      up.</para>

      <para>If you don't have the <application>Batik</application> package
      installed, run the following commands as the <systemitem
      class="username">root</systemitem> user:</para>

<screen role="root"><userinput>install -v -m644 lib/batik.jar /opt/fop-&fop-version;/lib &amp;&amp;
install -v -m644 lib/batik.LICENSE.txt \
    /opt/fop-&fop-version;/docs/lib</userinput></screen>

    </sect3>

    <sect3>
      <title>Installing the Xalan-Java components</title>

      <para>The components of <application>FOP</application> required to
      process FO files created by an XSL transformation engine (also known
      as an XSLT processor) is now complete. An XSL transformation engine
      (<command>xsltproc</command>) is included with the
      <xref linkend="libxslt"/> package in BLFS. The
      <application>FOP</application> package includes components of
      <ulink url="http://xml.apache.org/xalan-j/">Xalan-Java</ulink> to
      accomplish XSL transformations. If you have the
      <application>Xalan-Java</application> package installed, skip to
      the next section.</para>

      <para>If you wish to install the <application>Xalan-Java</application>
      components provided by the <application>FOP</application>
      package, run the following commands as the <systemitem
      class="username">root</systemitem> user:</para>

<screen role="root"><userinput>sed -i "s/build/lib/" xalan.sh &amp;&amp;
install -v -m755 xalan.sh /opt/fop-&fop-version;/bin &amp;&amp;
install -v -m644 lib/xml-apis.jar \
                 lib/xercesImpl-2.2.1.jar \
                 lib/xalan-2.4.1.jar \
    /opt/fop-&fop-version;/lib &amp;&amp;
install -v -m644 lib/{xml-apis,xerces,xalan}.LICENSE.txt \
                 lib/xml-apis.README.txt \
    /opt/fop-&fop-version;/docs/lib</userinput></screen>

    </sect3>

    <sect3>
      <title>Installing the Jimi SDK JAR</title>

      <para>If you installed the Java Image I/O class library
      (<application>Jimi SDK</application>) into the
      <application>FOP</application> source tree
      <filename class='directory'>lib</filename> directory before building
      <application>FOP</application> (this will enable Jimi
      support), ensure you also install this JAR file into
      <filename class='directory'>/opt/fop-&fop-version;/lib</filename>.</para>

    </sect3> -->

  </sect2>

  <sect2 role="commands">
    <title>Command Explanations</title>

    <para><command>FOP_PKG_DIR=$(pwd)/..</command>: This assumes that the
    source packages are stored one level above the current working directory.
    This is always the default; but may be different because of personal
    taste. If necessary, change this to match the directory where the
    <application>FOP</application> tarball can be found.</para>

    <para><command>sh $FOP_PKG_DIR/jai-&jai-version;-lib-linux-i586-jdk.bin</command>: This
    command installs the <application>JAI</application> components
    into the <application>JDK</application> file structure.
    <envar>$FOP_PKG_DIR</envar> is used as a reference point to the source
    executable.</para>

    <!-- <para><command>sed -i "s/build/lib/" ...</command>: These commands modify
    the installed shell scripts so that the location of the installed
    <filename>fop.jar</filename> file is correctly identified.</para> -->

    <!-- <para><command>install -v ...; cp -v ...</command>: There is no installation
    script provided by the <application>FOP</application>
    package. These commands install the package.</para> -->

    <para><command>ant dist</command>: This reads the <filename>build.xml</filename>
    file and performs the <option>dist</option> target that builds the
    package and runs the unit regression tests. It also creates the Java API
    documentation and a directory where the newly created binaries are placed
    into. This directory is used to install <application>FOP</application>
    to its final place.</para>

    <para><command>ln -v -sf fop-&fop-version; /opt/fop</command>: This is
    optional and creates a convenience symlink so that <envar>$FOP_HOME</envar>
    doesn't have to be changed each time there's a package version change.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuring FOP</title>

    <sect3 id="fop-config">
      <title>Config Files</title>

      <para><filename>~/.foprc</filename></para>

      <indexterm zone="fop fop-config">
        <primary sortas="e-AA.foprc">~/.foprc</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Configuration Information</title>

      <para>Using <application>FOP</application> to process some large FO's
      (including the FO derived from the BLFS XML sources), can lead to memory
      errors. Unless you add a parameter to the <command>java</command> command
      used in the <command>fop</command> script you may receive messages
      similar to the one shown below:</para>

      <para><computeroutput>Exception in thread "main" java.lang.OutOfMemoryError:
      Java heap space</computeroutput></para>

      <para>To avoid errors like this, you need to pass an extra parameter to
      the <command>java</command> command used in the <command>fop</command>
      script. This can be accomplished by creating a
      <filename>~/.foprc</filename> (which is sourced by the
      <command>fop</command> script) and adding the parameter to the
      <envar>FOP_OPTS</envar> environment variable.</para>

      <para>The <command>fop</command> script looks for a
      <envar>FOP_HOME</envar> environment variable to locate the
      <application>FOP</application> class libraries. You can create this
      variable using the <filename>~/.foprc</filename> file as well. Create
      a <filename>~/.foprc</filename> file using the following commands:</para>

<screen><userinput>cat &gt; ~/.foprc &lt;&lt; "EOF"
<literal>FOP_OPTS="-Xmx<replaceable>&lt;RAM_Installed&gt;</replaceable>m"
FOP_HOME="/opt/fop"</literal>

EOF</userinput></screen>

      <para>Replace <replaceable>&lt;RAM_Installed&gt;</replaceable> with a
      number representing the amount of RAM installed in your computer (in
      megabytes). An example would be
      <userinput>FOP_OPTS="-Xmx768m"</userinput>. For more information about
      memory issues running <application>FOP</application>, see
      <ulink url="http://xml.apache.org/fop/running.html#memory"/>.</para>

      <para>To include the <command>fop</command> script in your path,
      update your personal or system-wide profile with the following:</para>

<screen><literal>PATH=$PATH:/opt/fop</literal></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <segmentedlist>
      <segtitle>Installed Programs</segtitle>
      <segtitle>Installed Libraries</segtitle>
      <segtitle>Installed Directory</segtitle>

      <seglistitem>
        <seg>fop</seg>
        <seg>fop.jar and numerous support library classes located in
        <filename class='directory'>/opt/fop/{build,lib}</filename>; JAI
        components include libmlib_jai.so, jai_codec.jar, jai_core.jar, and
        mlibwrapper_jai.jar</seg>
        <seg>/opt/fop-&fop-version;</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Short Descriptions</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="fop-prog">
        <term><command>fop</command></term>
        <listitem>
          <para>is a wrapper script to the <command>java</command> command
          which sets up the <application>FOP</application>
          environment and passes the required parameters.</para>
          <indexterm zone="fop fop-prog">
            <primary sortas="b-fop">fop</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="fop.jar">
        <term><filename class='libraryfile'>fop.jar</filename></term>
        <listitem>
          <para>contains all the <application>FOP</application>
          <application>Java</application> classes.</para>
          <indexterm zone="fop fop.jar">
            <primary sortas="c-fop.jar">fop.jar</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
